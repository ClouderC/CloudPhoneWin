var me=Object.defineProperty;var L=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var M=(v,n,s)=>n in v?me(v,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):v[n]=s,O=(v,n)=>{for(var s in n||(n={}))ce.call(n,s)&&M(v,s,n[s]);if(L)for(var s of L(n))fe.call(n,s)&&M(v,s,n[s]);return v};var z=(v,n,s)=>new Promise((k,C)=>{var U=c=>{try{m(s.next(c))}catch(V){C(V)}},x=c=>{try{m(s.throw(c))}catch(V){C(V)}},m=c=>c.done?k(c.value):Promise.resolve(c.value).then(U,x);m((s=s.apply(v,n)).next())});import{a as ge,d as ve,b as _e,u as be,c as ye,e as ke}from"./role-JmTjpzjj.js";import{g as Ce}from"./permission-oQVXAKlj.js";import{v as Ve,r as b,e as N,o as we,p as he,q as h,H as l,R as t,F as D,G as I,D as r,S as p,ae as A,U as S,Q as xe,E as Re,a8 as y,aD as ze,V as Se,_ as Ue}from"./index-DqYxAufE.js";const De={class:"main"},Pe={class:"card-header"},Ke={class:"pagination-container"},Te={class:"permission-tree-container"},Ie=Ve({name:"SystemRole",__name:"index",setup(v){const n=b(!1),s=b([]),k=b(!1),C=b(!1),U=b(""),x=b(),m=b(),c=b([]),V=b(0),f=N({name:"",code:"",status:null}),g=N({page:1,pageSize:10,total:0}),d=N({id:0,name:"",code:"",description:"",status:1}),H={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},G=o=>{const e=[],i=_=>{for(const u of _)!u.children||u.children.length===0?e.push(u.id):i(u.children)};return i(o),e},R=()=>z(null,null,function*(){n.value=!0;try{const o=O({page:g.page,pageSize:g.pageSize,name:f.name,code:f.code},f.status!==null&&f.status!==""?{status:f.status}:{}),e=yield ge(o);e.data?(s.value=e.data.list||[],g.total=e.data.total||0):(s.value=[],g.total=0)}catch(o){y.error("获取角色列表失败")}finally{n.value=!1}}),B=()=>{g.page=1,R()},Q=()=>{Object.assign(f,{name:"",code:"",status:null}),B()},J=()=>{U.value="新增角色",Object.assign(d,{id:0,name:"",code:"",description:"",status:1}),k.value=!0},W=o=>{U.value="编辑角色",Object.assign(d,o),k.value=!0},X=o=>z(null,null,function*(){try{yield ze.confirm("确定要删除该角色吗？","提示",{type:"warning"}),yield ve(o.id),y.success("删除成功"),R()}catch(e){e!=="cancel"&&y.error("删除失败")}}),Y=o=>z(null,null,function*(){V.value=o.id;try{const e=yield Ce();e.data&&e.data.list?c.value=e.data.list:c.value=[];const _=(yield _e(o.id)).data||[];C.value=!0,yield Se(),setTimeout(()=>{if(m.value){m.value.setCheckedKeys([]);const u=G(c.value),P=_.filter(K=>u.includes(K));m.value.setCheckedKeys(P,!1);const E=m.value.getCheckedKeys()}},300)}catch(e){y.error("获取权限数据失败")}}),Z=()=>z(null,null,function*(){if(x.value)try{yield x.value.validate(),d.id?(yield be(d.id,d),y.success("更新成功")):(yield ye(d),y.success("创建成功")),k.value=!1,R()}catch(o){y.error(d.id?"更新失败":"创建失败")}}),ee=()=>z(null,null,function*(){try{const o=m.value.getCheckedKeys(),e=m.value.getHalfCheckedKeys(),i=[...o,...e];yield ke(V.value,{permissionIds:i}),y.success("权限分配成功"),C.value=!1}catch(o){y.error("权限分配失败")}}),le=()=>{var o;(o=x.value)==null||o.resetFields()},te=()=>{V.value=0,c.value=[],m.value&&m.value.setCheckedKeys([])},ae=o=>{g.pageSize=o,R()},oe=o=>{g.page=o,R()};return we(()=>{R()}),(o,e)=>{const i=r("el-button"),_=r("el-input"),u=r("el-form-item"),P=r("el-option"),E=r("el-select"),K=r("el-form"),w=r("el-table-column"),$=r("el-tag"),se=r("el-button-group"),ne=r("el-table"),de=r("el-pagination"),ie=r("el-card"),q=r("el-radio"),re=r("el-radio-group"),j=r("el-dialog"),ue=r("el-tree"),T=A("perms"),pe=A("loading");return h(),he("div",De,[l(ie,{shadow:"never"},{header:t(()=>[I("div",Pe,[e[14]||(e[14]=I("span",null,"角色管理",-1)),D((h(),S(i,{onClick:J},{default:t(()=>e[13]||(e[13]=[p(" 新增角色 ")])),_:1})),[[T,["system:role:add"]]])])]),default:t(()=>[l(K,{model:f,inline:"",class:"search-form"},{default:t(()=>[l(u,{label:"角色名称"},{default:t(()=>[l(_,{modelValue:f.name,"onUpdate:modelValue":e[0]||(e[0]=a=>f.name=a),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"角色编码"},{default:t(()=>[l(_,{modelValue:f.code,"onUpdate:modelValue":e[1]||(e[1]=a=>f.code=a),placeholder:"请输入角色编码",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"状态"},{default:t(()=>[l(E,{modelValue:f.status,"onUpdate:modelValue":e[2]||(e[2]=a=>f.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[l(P,{label:"启用",value:1}),l(P,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(i,{onClick:B},{default:t(()=>e[15]||(e[15]=[p("搜索")])),_:1}),l(i,{onClick:Q},{default:t(()=>e[16]||(e[16]=[p("重置")])),_:1})]),_:1})]),_:1},8,["model"]),D((h(),S(ne,{data:s.value,border:""},{default:t(()=>[l(w,{prop:"id",label:"ID",width:"80"}),l(w,{prop:"name",label:"角色名称",width:"120"}),l(w,{prop:"code",label:"角色编码",width:"120"}),l(w,{prop:"description",label:"描述","min-width":"200"}),l(w,{prop:"status",label:"状态",width:"80"},{default:t(({row:a})=>[l($,{type:a.status===1?"success":"danger",size:"small"},{default:t(()=>[p(xe(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(w,{prop:"createdAt",label:"创建时间",width:"160"}),l(w,{label:"操作",width:"200"},{default:t(({row:a})=>[l(se,null,{default:t(()=>[D((h(),S(i,{type:"primary",link:"",onClick:F=>W(a)},{default:t(()=>e[17]||(e[17]=[p(" 编辑 ")])),_:2},1032,["onClick"])),[[T,["system:role:edit"]]]),a.code!=="admin"?D((h(),S(i,{key:0,type:"warning",link:"",onClick:F=>Y(a)},{default:t(()=>e[18]||(e[18]=[p(" 分配权限 ")])),_:2},1032,["onClick"])),[[T,["system:role:permission"]]]):(h(),S($,{key:1,type:"success",size:"small"},{default:t(()=>e[19]||(e[19]=[p(" 自动拥有所有权限 ")])),_:1})),a.code!=="admin"?D((h(),S(i,{key:2,type:"danger",link:"",onClick:F=>X(a)},{default:t(()=>e[20]||(e[20]=[p(" 删除 ")])),_:2},1032,["onClick"])),[[T,["system:role:delete"]]]):Re("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[pe,n.value]]),I("div",Ke,[l(de,{"current-page":g.page,"onUpdate:currentPage":e[3]||(e[3]=a=>g.page=a),"page-size":g.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>g.pageSize=a),"page-sizes":[10,20,50,100],total:g.total,layout:"total, sizes, prev, pager, next",onSizeChange:ae,onCurrentChange:oe},null,8,["current-page","page-size","total"])])]),_:1}),l(j,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=a=>k.value=a),title:U.value,width:"600px",onClose:le},{footer:t(()=>[l(i,{onClick:e[9]||(e[9]=a=>k.value=!1)},{default:t(()=>e[23]||(e[23]=[p("取消")])),_:1}),l(i,{onClick:Z},{default:t(()=>e[24]||(e[24]=[p("确定")])),_:1})]),default:t(()=>[l(K,{ref_key:"formRef",ref:x,model:d,rules:H,"label-width":"100px"},{default:t(()=>[l(u,{label:"角色名称",prop:"name"},{default:t(()=>[l(_,{modelValue:d.name,"onUpdate:modelValue":e[5]||(e[5]=a=>d.name=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"角色编码",prop:"code"},{default:t(()=>[l(_,{modelValue:d.code,"onUpdate:modelValue":e[6]||(e[6]=a=>d.code=a),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),l(u,{label:"描述",prop:"description"},{default:t(()=>[l(_,{modelValue:d.description,"onUpdate:modelValue":e[7]||(e[7]=a=>d.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"status"},{default:t(()=>[l(re,{modelValue:d.status,"onUpdate:modelValue":e[8]||(e[8]=a=>d.status=a)},{default:t(()=>[l(q,{label:1},{default:t(()=>e[21]||(e[21]=[p("启用")])),_:1}),l(q,{label:0},{default:t(()=>e[22]||(e[22]=[p("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=a=>C.value=a),title:"分配权限",width:"800px",onClose:te},{footer:t(()=>[l(i,{onClick:e[11]||(e[11]=a=>C.value=!1)},{default:t(()=>e[25]||(e[25]=[p("取消")])),_:1}),l(i,{onClick:ee},{default:t(()=>e[26]||(e[26]=[p("确定")])),_:1})]),default:t(()=>[I("div",Te,[l(ue,{ref_key:"permissionTreeRef",ref:m,data:c.value,props:{children:"children",label:"name"},"node-key":"id","show-checkbox":"","default-expand-all":"",class:"permission-tree"},null,8,["data"])])]),_:1},8,["modelValue"])])}}}),qe=Ue(Ie,[["__scopeId","data-v-ea856317"]]);export{qe as default};
