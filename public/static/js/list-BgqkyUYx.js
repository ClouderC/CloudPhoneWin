var w=(C,y,d)=>new Promise((s,u)=>{var v=l=>{try{r(d.next(l))}catch(_){u(_)}},g=l=>{try{r(d.throw(l))}catch(_){u(_)}},r=l=>l.done?s(l.value):Promise.resolve(l.value).then(v,g);r((d=d.apply(C,y)).next())});import{g as K,d as $}from"./file-BLpzX1t2.js";import{F as q}from"./FileUploadDialog-D8hAWV6K.js";import{v as H,r as c,o as Q,p as R,q as S,H as o,R as n,G as m,D as i,S as p,F as j,ae as J,U as O,Q as x,a8 as h,aD as W,_ as X}from"./index-DqYxAufE.js";import"./TaskProgressDialog-PHmw-w02.js";import"./app-CvfiZxnR.js";const Y={class:"page-container"},Z={class:"card-header"},ee={class:"search-bar"},ae={class:"card-content"},te={class:"pagination-container"},le=H({__name:"list",setup(C){const y=c([]),d=c(0),s=c(1),u=c(10),v=c(!1),g=c(""),r=c(!1),l=()=>w(null,null,function*(){v.value=!0;try{const e=yield K({page:s.value,pageSize:u.value,originalName:g.value});e.code===0?(y.value=e.data.list,d.value=e.data.total):h.error(e.message||"获取文件列表失败")}catch(e){console.error("获取文件列表出错:",e),h.error("获取文件列表出错")}finally{v.value=!1}}),_=()=>{s.value=1,l()},B=()=>{g.value="",s.value=1,l()},k=e=>{s.value=e,l()},F=e=>{u.value=e,s.value=1,l()},V=e=>{r.value=!1,l()},D=e=>{console.error("文件上传失败:",e),e&&e.message&&e.message.includes("已存在")&&l()},U=()=>{r.value=!0},T=e=>{W.confirm(`确定要删除文件 "${e.fileName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>w(null,null,function*(){try{const a=yield $(e.fileId);a.code===0?(h.success("文件删除成功"),l()):h.error(a.message||"文件删除失败")}catch(a){console.error("删除文件出错:",a),h.error("删除文件出错")}})).catch(()=>{})},N=e=>e<1024?e+"B":e<1024*1024?(e/1024).toFixed(2)+"KB":e<1024*1024*1024?(e/(1024*1024)).toFixed(2)+"MB":(e/(1024*1024*1024)).toFixed(2)+"GB",z=e=>{switch(e){case"image":return"success";case"document":return"primary";case"video":return"warning";case"audio":return"info";case"archive":return"danger";case"app":return"warning";default:return"info"}};return Q(()=>{l()}),(e,a)=>{const b=i("el-button"),E=i("el-input"),f=i("el-table-column"),M=i("el-tag"),L=i("el-button-group"),P=i("el-table"),A=i("el-pagination"),G=i("el-card"),I=J("loading");return S(),R("div",Y,[o(G,{class:"box-card"},{header:n(()=>[m("div",Z,[a[6]||(a[6]=m("span",null,"文件列表",-1)),m("div",null,[o(b,{onClick:a[0]||(a[0]=t=>U())},{default:n(()=>a[5]||(a[5]=[p("上传文件")])),_:1})])])]),default:n(()=>[m("div",ee,[o(E,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t),placeholder:"搜索原始文件名",class:"search-input"},null,8,["modelValue"]),o(b,{onClick:_},{default:n(()=>a[7]||(a[7]=[p("搜索")])),_:1}),o(b,{onClick:B},{default:n(()=>a[8]||(a[8]=[p("重置")])),_:1})]),m("div",ae,[j((S(),O(P,{data:y.value,style:{width:"100%"}},{default:n(()=>[o(f,{prop:"fileName",label:"文件名称",width:"300"}),o(f,{prop:"originalName",label:"原始文件名",width:"350"}),o(f,{label:"大小",width:"100"},{default:n(({row:t})=>[p(x(N(t.fileSize)),1)]),_:1}),o(f,{prop:"fileType",label:"类型",width:"120"},{default:n(({row:t})=>[o(M,{type:z(t.fileType)},{default:n(()=>[p(x(t.fileType||"未知"),1)]),_:2},1032,["type"])]),_:1}),o(f,{prop:"updatedAt",label:"更新时间",width:"180"},{default:n(({row:t})=>[p(x(t.updatedAt||"未知"),1)]),_:1}),o(f,{label:"操作",width:"120"},{default:n(({row:t})=>[o(L,null,{default:n(()=>[o(b,{type:"danger",link:"",onClick:oe=>T(t)},{default:n(()=>a[9]||(a[9]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[I,v.value]]),m("div",te,[o(A,{"current-page":s.value,"onUpdate:currentPage":a[2]||(a[2]=t=>s.value=t),"page-size":u.value,"onUpdate:pageSize":a[3]||(a[3]=t=>u.value=t),"page-sizes":[10,20,50,100],total:d.value,layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:k},null,8,["current-page","page-size","total"])])])]),_:1}),o(q,{modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=t=>r.value=t),"device-ids":[],"max-worker":1,onSuccess:V,onError:D},null,8,["modelValue"])])}}}),ce=X(le,[["__scopeId","data-v-8d3436e7"]]);export{ce as default};
