var w=(p,q,b)=>new Promise((z,U)=>{var C=i=>{try{m(b.next(i))}catch(s){U(s)}},T=i=>{try{m(b.throw(i))}catch(s){U(s)}},m=i=>i.done?z(i.value):Promise.resolve(i.value).then(C,T);m((b=b.apply(p,q)).next())});import{aa as D,v as se,r as g,e as oe,o as ne,a8 as d,p as V,q as r,H as l,R as o,G as v,D as c,K as F,L as K,U as S,Q as f,aC as $,S as y,F as de,ae as ue,E as ie,aD as re,_ as ce}from"./index-DqYxAufE.js";import{g as pe}from"./device-MWnAPMey.js";function ve(p){return D.request("get","/api/apps/list",{params:p})}function me(p){return D.request("get","/api/app-account/list",{params:p})}function fe(p){return D.request("post","/api/app-account/create",{data:p})}function P(p){return D.request("put","/api/app-account/update",{data:p})}function ge(p){return D.request("delete","/api/app-account/delete",{data:{id:p}})}const _e={class:"page-container"},ye={class:"card-header"},be={class:"search-bar"},Ie={style:{float:"right",color:"#8492a6","font-size":"13px"}},he={class:"card-content"},Ve={key:0},ke={key:1,class:"text-gray"},we={key:0},Ce={key:1,class:"text-gray"},xe={class:"pagination-container"},Ae={style:{float:"right",color:"#8492a6","font-size":"13px"}},ze={style:{float:"right",color:"#8492a6","font-size":"13px"}},Ue={class:"dialog-footer"},Le=se({__name:"list",setup(p){const q=g([]),b=g([]),z=g(!1),U=g(0),C=g(1),T=g(100),m=g(!1),i=g("add"),s=g({id:0,appId:void 0,deviceId:void 0,account:"",password:"",status:1,description:""}),n=oe({appId:void 0,account:"",status:"",description:""}),M=g([]);ne(()=>{k(),E(),B()});const E=(...e)=>w(null,[...e],function*(a={}){try{const u=yield ve({page:a.page||1,pageSize:a.pageSize||100,keyword:a.keyword});u.code===0?b.value=u.data.list.sort((h,x)=>new Date(x.createdAt).getTime()-new Date(h.createdAt).getTime()):d.error(u.message||"获取应用列表失败")}catch(u){d.error("获取应用列表失败")}}),B=(a="")=>w(null,null,function*(){try{const e=yield pe({page:1,pageSize:100,keyword:a});e.code===0?M.value=e.data.list:d.error(e.message||"获取设备列表失败")}catch(e){let u="获取设备列表失败";e.response&&e.response.data&&e.response.data.message?u=e.response.data.message:e.message&&(u=e.message),d.error(u)}}),k=()=>w(null,null,function*(){z.value=!0;try{const a={page:C.value,size:T.value};n.appId!==void 0&&(a.appId=n.appId),(n.status===0||n.status===1)&&(a.status=n.status),n.account&&(a.account=n.account),n.description&&(a.description=n.description);const e=yield me(a);e.code===0?(q.value=e.data.list,U.value=e.data.total):d.error(e.message||"获取帐号列表失败")}catch(a){d.error("获取帐号列表失败")}finally{z.value=!1}}),I=()=>{C.value=1,k()},G=()=>{n.appId=void 0,n.account="",n.status="",n.description="",I()},H=a=>{C.value=a,k()},Q=()=>{i.value="add",s.value={id:0,appId:void 0,deviceId:void 0,account:"",password:"",status:1,description:""},m.value=!0,B()},R=a=>{i.value="edit",s.value={id:a.id,appId:void 0,deviceId:void 0,account:a.account,password:a.password,status:a.status,description:a.description},setTimeout(()=>{s.value.appId=a.appId,s.value.deviceId=a.deviceId>0?a.deviceId:void 0},100),m.value=!0,B(),E()},j=a=>w(null,null,function*(){try{const e=yield P({id:a.id,appId:a.appId,deviceId:a.deviceId>0?a.deviceId:void 0,account:a.account,password:a.password,status:a.status===1?0:1,description:a.description});e.code===0?(d.success("状态更新成功"),k()):d.error(e.message||"状态更新失败")}catch(e){d.error("状态更新失败")}}),J=a=>{re.confirm("确定要删除该帐号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>w(null,null,function*(){try{const e=yield ge(a.id);e.code===0?(d.success("删除成功"),k()):d.error(e.message||"删除失败")}catch(e){d.error("删除失败")}}))},O=()=>w(null,null,function*(){if(!s.value.account||!s.value.password){d.warning("请填写帐号和密码");return}if(!s.value.appId){d.warning("请选择应用");return}try{if(i.value==="add"){const a=yield fe({appId:s.value.appId,deviceId:s.value.deviceId,account:s.value.account,password:s.value.password,description:s.value.description});a.code===0?(d.success("创建成功"),m.value=!1,k()):d.error(a.message||"创建失败")}else{const a=yield P({id:s.value.id,appId:s.value.appId,deviceId:s.value.deviceId,account:s.value.account,password:s.value.password,status:s.value.status,description:s.value.description});a.code===0?(d.success("更新成功"),m.value=!1,k()):d.error(a.message||"更新失败")}}catch(a){d.error("操作失败")}});return(a,e)=>{const u=c("el-button"),h=c("el-option"),x=c("el-select"),L=c("el-input"),_=c("el-table-column"),W=c("el-tag"),X=c("el-table"),Y=c("el-pagination"),Z=c("el-card"),A=c("el-form-item"),ee=c("el-switch"),te=c("el-form"),ae=c("el-dialog"),le=ue("loading");return r(),V("div",_e,[l(Z,{class:"box-card"},{header:o(()=>[v("div",ye,[e[13]||(e[13]=v("span",null,"应用帐号列表",-1)),l(u,{type:"primary",onClick:Q},{default:o(()=>e[12]||(e[12]=[y("添加帐号")])),_:1})])]),default:o(()=>[v("div",be,[l(x,{modelValue:n.appId,"onUpdate:modelValue":e[0]||(e[0]=t=>n.appId=t),filterable:"",clearable:"",placeholder:"选择应用",class:"app-select",onChange:I},{default:o(()=>[(r(!0),V(F,null,K(b.value,t=>(r(),S(h,{key:t.id,label:t.name,value:t.id},{default:o(()=>[v("span",null,f(t.name),1),v("span",Ie,f(t.version),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),l(L,{modelValue:n.account,"onUpdate:modelValue":e[1]||(e[1]=t=>n.account=t),placeholder:"搜索帐号",clearable:"",class:"search-input",onKeyup:$(I,["enter"]),onClear:I},null,8,["modelValue"]),l(L,{modelValue:n.description,"onUpdate:modelValue":e[2]||(e[2]=t=>n.description=t),placeholder:"搜索描述",clearable:"",class:"search-input",onKeyup:$(I,["enter"]),onClear:I},null,8,["modelValue"]),l(x,{modelValue:n.status,"onUpdate:modelValue":e[3]||(e[3]=t=>n.status=t),placeholder:"帐号状态",clearable:"",class:"filter-select",onChange:I},{default:o(()=>[l(h,{label:"全部",value:""}),l(h,{label:"启用",value:1}),l(h,{label:"禁用",value:0})]),_:1},8,["modelValue"]),l(u,{type:"primary",onClick:I},{default:o(()=>e[14]||(e[14]=[y("搜索")])),_:1}),l(u,{onClick:G},{default:o(()=>e[15]||(e[15]=[y("重置")])),_:1})]),v("div",he,[de((r(),S(X,{data:q.value,style:{width:"100%"}},{default:o(()=>[l(_,{prop:"account",label:"帐号",width:"150"}),l(_,{prop:"password",label:"密码",width:"150"}),l(_,{label:"绑定应用",width:"150"},{default:o(({row:t})=>[t.app?(r(),V("span",Ve,f(t.app.name)+"("+f(t.app.version)+")",1)):(r(),V("span",ke,"未绑定"))]),_:1}),l(_,{label:"绑定设备",width:"150"},{default:o(({row:t})=>[t.device&&t.deviceId>0?(r(),V("span",we,f(t.device.deviceId),1)):(r(),V("span",Ce,"未绑定"))]),_:1}),l(_,{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[l(W,{type:t.status===1?"success":"danger"},{default:o(()=>[y(f(t.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(_,{prop:"description",label:"描述",width:"200"}),l(_,{prop:"createdAt",label:"创建时间",width:"180"}),l(_,{prop:"updatedAt",label:"更新时间",width:"180"}),l(_,{label:"操作",width:"200"},{default:o(({row:t})=>[l(u,{type:"primary",size:"small",onClick:N=>R(t)},{default:o(()=>e[16]||(e[16]=[y("编辑")])),_:2},1032,["onClick"]),l(u,{type:t.status===1?"danger":"success",size:"small",onClick:N=>j(t)},{default:o(()=>[y(f(t.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(u,{type:"danger",size:"small",onClick:N=>J(t)},{default:o(()=>e[17]||(e[17]=[y("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,z.value]]),v("div",xe,[l(Y,{background:"",layout:"prev, pager, next",total:U.value,"current-page":C.value,"page-size":T.value,onCurrentChange:H},null,8,["total","current-page","page-size"])])])]),_:1}),l(ae,{modelValue:m.value,"onUpdate:modelValue":e[11]||(e[11]=t=>m.value=t),title:i.value==="add"?"添加帐号":"编辑帐号",width:"500px"},{footer:o(()=>[v("span",Ue,[l(u,{onClick:e[10]||(e[10]=t=>m.value=!1)},{default:o(()=>e[18]||(e[18]=[y("取消")])),_:1}),l(u,{type:"primary",onClick:O},{default:o(()=>e[19]||(e[19]=[y("确定")])),_:1})])]),default:o(()=>[l(te,{model:s.value,"label-width":"80px"},{default:o(()=>[l(A,{label:"应用",required:""},{default:o(()=>[l(x,{modelValue:s.value.appId,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.appId=t),filterable:"",remote:"","remote-method":t=>E({page:1,pageSize:100,keyword:t}),placeholder:"请选择应用",style:{width:"100%"}},{default:o(()=>[(r(!0),V(F,null,K(b.value,t=>(r(),S(h,{key:t.id,label:t.name,value:t.id},{default:o(()=>[v("span",null,f(t.name),1),v("span",Ae,f(t.version),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","remote-method"])]),_:1}),l(A,{label:"设备"},{default:o(()=>[l(x,{modelValue:s.value.deviceId,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.deviceId=t),filterable:"",clearable:"",remote:"","remote-method":B,placeholder:"请选择设备（可选）",style:{width:"100%"}},{default:o(()=>[(r(!0),V(F,null,K(M.value,t=>(r(),S(h,{key:t.id,label:t.name,value:t.id},{default:o(()=>[v("span",null,f(t.name),1),v("span",ze,f(t.deviceId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(A,{label:"帐号",required:""},{default:o(()=>[l(L,{modelValue:s.value.account,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.account=t),placeholder:"请输入帐号"},null,8,["modelValue"])]),_:1}),l(A,{label:"密码",required:""},{default:o(()=>[l(L,{modelValue:s.value.password,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.password=t),type:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(A,{label:"描述"},{default:o(()=>[l(L,{modelValue:s.value.description,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.description=t),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),i.value==="edit"?(r(),S(A,{key:0,label:"状态"},{default:o(()=>[l(ee,{modelValue:s.value.status,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.status=t),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})):ie("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Te=ce(Le,[["__scopeId","data-v-b3dfa00f"]]);export{Te as default};
