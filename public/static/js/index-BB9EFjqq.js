var ve=Object.defineProperty;var T=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var H=(c,d,r)=>d in c?ve(c,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[d]=r,K=(c,d)=>{for(var r in d||(d={}))_e.call(d,r)&&H(c,r,d[r]);if(T)for(var r of T(d))we.call(d,r)&&H(c,r,d[r]);return c};var D=(c,d,r)=>new Promise((w,y)=>{var R=b=>{try{U(r.next(b))}catch(V){y(V)}},S=b=>{try{U(r.throw(b))}catch(V){y(V)}},U=b=>b.done?w(b.value):Promise.resolve(b.value).then(R,S);U((r=r.apply(c,d)).next())});import{v as ye,r as v,e as F,o as Ve,p as $,q as f,H as a,R as t,F as A,G as j,D as u,S as i,ae as Q,U as C,K as W,L as X,Q as J,E as ke,b0 as Ce,a8 as _,aD as Ue,b1 as xe,b2 as ze,b3 as Se,b4 as Pe,_ as De}from"./index-DqYxAufE.js";import{g as Re}from"./role-JmTjpzjj.js";import{R as Y}from"./rule-BGnYMo3V.js";const Ee={class:"main"},Ae={class:"card-header"},qe={class:"pagination-container"},Fe=ye({name:"SystemUser",__name:"index",setup(c){const d=v(!1),r=v([]),w=v(!1),y=v(!1),R=v(""),S=v(),U=v(),b=v(0),V=v([]),p=F({username:"",nickname:"",status:null}),m=F({page:1,pageSize:10,total:0}),n=F({id:0,username:"",password:"",nickname:"",roles:[],status:1}),k=F({password:"",confirmPassword:""}),Z={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:(s,e,o)=>{e&&!Y.test(e)?o(new Error("密码格式应为8-18位数字、字母、符号的任意两种组合")):o()},trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},h={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{validator:(s,e,o)=>{e&&!Y.test(e)?o(new Error("密码格式应为8-18位数字、字母、符号的任意两种组合")):o()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(s,e,o)=>{e!==k.password?o(new Error("两次输入的密码不一致")):o()},trigger:"blur"}]},P=()=>D(null,null,function*(){d.value=!0;try{const s=K({page:m.page,pageSize:m.pageSize,username:p.username,nickname:p.nickname},p.status!==null&&p.status!==""?{status:p.status}:{}),e=yield Ce(s);e.data?(r.value=e.data.list||[],m.total=e.data.total||0):(r.value=[],m.total=0)}catch(s){_.error("获取用户列表失败")}finally{d.value=!1}}),ee=()=>D(null,null,function*(){try{const s=yield Re();Array.isArray(s)?V.value=s:s.data&&Array.isArray(s.data)?V.value=s.data:V.value=[]}catch(s){console.error("获取角色列表失败:",s),_.error("获取角色列表失败")}}),L=()=>{m.page=1,P()},ae=()=>{Object.assign(p,{username:"",nickname:"",status:null}),L()},le=()=>{R.value="新增用户",Object.assign(n,{id:0,username:"",password:"",nickname:"",roles:["user"],status:1}),w.value=!0},te=s=>{R.value="编辑用户",Object.assign(n,{id:s.id,username:s.username,password:"",nickname:s.nickname,roles:Array.isArray(s.roles)?s.roles:[],status:s.status}),w.value=!0},se=s=>D(null,null,function*(){try{yield Ue.confirm("确定要删除该用户吗？","提示",{type:"warning"}),yield xe(s.id),_.success("删除成功"),P()}catch(e){if(e!=="cancel"){const o=e.message||"删除失败";_.error(o)}}}),oe=s=>{b.value=s.id,Object.assign(k,{password:"",confirmPassword:""}),y.value=!0},re=()=>D(null,null,function*(){if(S.value)try{yield S.value.validate(),n.id?(yield ze(n.id,n),_.success("更新成功")):(yield Se(n),_.success("创建成功")),w.value=!1,P()}catch(s){const e=s.message||(n.id?"更新失败":"创建失败");_.error(e)}}),ne=()=>D(null,null,function*(){if(U.value)try{yield U.value.validate(),yield Pe(b.value,{password:k.password}),_.success("密码重置成功"),y.value=!1}catch(s){const e=s.message||"密码重置失败";_.error(e)}}),de=()=>{var s;(s=S.value)==null||s.resetFields()},ue=s=>{m.pageSize=s,P()},ie=s=>{m.page=s,P()};return Ve(()=>{P(),ee()}),(s,e)=>{const o=u("el-button"),x=u("el-input"),g=u("el-form-item"),O=u("el-option"),N=u("el-select"),B=u("el-form"),z=u("el-table-column"),I=u("el-tag"),pe=u("el-button-group"),me=u("el-table"),ge=u("el-pagination"),fe=u("el-card"),M=u("el-radio"),ce=u("el-radio-group"),G=u("el-dialog"),q=Q("perms"),be=Q("loading");return f(),$("div",Ee,[a(fe,{shadow:"never"},{header:t(()=>[j("div",Ae,[e[17]||(e[17]=j("span",null,"用户管理",-1)),A((f(),C(o,{onClick:le},{default:t(()=>e[16]||(e[16]=[i(" 新增用户 ")])),_:1})),[[q,["system:user:add"]]])])]),default:t(()=>[a(B,{model:p,inline:"",class:"search-form"},{default:t(()=>[a(g,{label:"用户名"},{default:t(()=>[a(x,{modelValue:p.username,"onUpdate:modelValue":e[0]||(e[0]=l=>p.username=l),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),a(g,{label:"昵称"},{default:t(()=>[a(x,{modelValue:p.nickname,"onUpdate:modelValue":e[1]||(e[1]=l=>p.nickname=l),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])]),_:1}),a(g,{label:"状态"},{default:t(()=>[a(N,{modelValue:p.status,"onUpdate:modelValue":e[2]||(e[2]=l=>p.status=l),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[a(O,{label:"启用",value:1}),a(O,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),a(g,null,{default:t(()=>[a(o,{onClick:L},{default:t(()=>e[18]||(e[18]=[i("搜索")])),_:1}),a(o,{onClick:ae},{default:t(()=>e[19]||(e[19]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"]),A((f(),C(me,{data:r.value,border:""},{default:t(()=>[a(z,{prop:"id",label:"ID",width:"80"}),a(z,{prop:"username",label:"用户名",width:"120"}),a(z,{prop:"nickname",label:"昵称",width:"120"}),a(z,{prop:"roles",label:"角色","min-width":"150"},{default:t(({row:l})=>[(f(!0),$(W,null,X(l.roles,E=>(f(),C(I,{key:E,type:"primary",size:"small",style:{"margin-right":"5px"}},{default:t(()=>[i(J(E),1)]),_:2},1024))),128))]),_:1}),a(z,{prop:"status",label:"状态",width:"80"},{default:t(({row:l})=>[a(I,{type:l.status===1?"success":"danger",size:"small"},{default:t(()=>[i(J(l.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(z,{prop:"createdAt",label:"创建时间",width:"160"}),a(z,{label:"操作",width:"200"},{default:t(({row:l})=>[a(pe,null,{default:t(()=>[A((f(),C(o,{type:"primary",link:"",onClick:E=>te(l)},{default:t(()=>e[20]||(e[20]=[i(" 编辑 ")])),_:2},1032,["onClick"])),[[q,["system:user:edit"]]]),A((f(),C(o,{type:"warning",link:"",onClick:E=>oe(l)},{default:t(()=>e[21]||(e[21]=[i(" 重置密码 ")])),_:2},1032,["onClick"])),[[q,["system:user:edit"]]]),A((f(),C(o,{type:"danger",link:"",onClick:E=>se(l)},{default:t(()=>e[22]||(e[22]=[i(" 删除 ")])),_:2},1032,["onClick"])),[[q,["system:user:delete"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[be,d.value]]),j("div",qe,[a(ge,{"current-page":m.page,"onUpdate:currentPage":e[3]||(e[3]=l=>m.page=l),"page-size":m.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>m.pageSize=l),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next",onSizeChange:ue,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),_:1}),a(G,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=l=>w.value=l),title:R.value,width:"600px",onClose:de},{footer:t(()=>[a(o,{onClick:e[10]||(e[10]=l=>w.value=!1)},{default:t(()=>e[25]||(e[25]=[i("取消")])),_:1}),a(o,{onClick:re},{default:t(()=>e[26]||(e[26]=[i("确定")])),_:1})]),default:t(()=>[a(B,{ref_key:"formRef",ref:S,model:n,rules:Z,"label-width":"100px"},{default:t(()=>[a(g,{label:"用户名",prop:"username"},{default:t(()=>[a(x,{modelValue:n.username,"onUpdate:modelValue":e[5]||(e[5]=l=>n.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),n.id?ke("",!0):(f(),C(g,{key:0,label:"密码",prop:"password"},{default:t(()=>[a(x,{modelValue:n.password,"onUpdate:modelValue":e[6]||(e[6]=l=>n.password=l),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),a(g,{label:"昵称",prop:"nickname"},{default:t(()=>[a(x,{modelValue:n.nickname,"onUpdate:modelValue":e[7]||(e[7]=l=>n.nickname=l),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(g,{label:"角色",prop:"roles"},{default:t(()=>[a(N,{modelValue:n.roles,"onUpdate:modelValue":e[8]||(e[8]=l=>n.roles=l),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(f(!0),$(W,null,X(V.value,l=>(f(),C(O,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"状态",prop:"status"},{default:t(()=>[a(ce,{modelValue:n.status,"onUpdate:modelValue":e[9]||(e[9]=l=>n.status=l)},{default:t(()=>[a(M,{label:1},{default:t(()=>e[23]||(e[23]=[i("启用")])),_:1}),a(M,{label:0},{default:t(()=>e[24]||(e[24]=[i("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(G,{modelValue:y.value,"onUpdate:modelValue":e[15]||(e[15]=l=>y.value=l),title:"重置密码",width:"400px"},{footer:t(()=>[a(o,{onClick:e[14]||(e[14]=l=>y.value=!1)},{default:t(()=>e[27]||(e[27]=[i("取消")])),_:1}),a(o,{onClick:ne},{default:t(()=>e[28]||(e[28]=[i("确定")])),_:1})]),default:t(()=>[a(B,{ref_key:"passwordFormRef",ref:U,model:k,rules:h,"label-width":"100px"},{default:t(()=>[a(g,{label:"新密码",prop:"password"},{default:t(()=>[a(x,{modelValue:k.password,"onUpdate:modelValue":e[12]||(e[12]=l=>k.password=l),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(g,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[a(x,{modelValue:k.confirmPassword,"onUpdate:modelValue":e[13]||(e[13]=l=>k.confirmPassword=l),type:"password",placeholder:"请确认新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Le=De(Fe,[["__scopeId","data-v-799b8c68"]]);export{Le as default};
