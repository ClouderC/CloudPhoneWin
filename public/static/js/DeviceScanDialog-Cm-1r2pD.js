var I=(z,U,x)=>new Promise((D,w)=>{var u=o=>{try{h(x.next(o))}catch(y){w(y)}},c=o=>{try{h(x.throw(o))}catch(y){w(y)}},h=o=>o.done?D(o.value):Promise.resolve(o.value).then(u,c);h((x=x.apply(z,U)).next())});import{j as ne,k as P}from"./device-MWnAPMey.js";import{v as oe,c as T,r as _,o as ie,U as M,q as r,R as n,G as i,F as ue,p as $,E as j,H as a,D as g,S as k,Q as d,ae as re,K as E,L as O,a8 as s,aD as de,_ as ce}from"./index-DqYxAufE.js";const ve={class:"device-scan-container"},fe={class:"scan-header"},pe={class:"scan-tips"},ge={class:"scan-actions"},me={class:"scan-result"},_e={class:"result-header"},he={class:"group-select"},ye={class:"name-prefix"},be={class:"table-container"},we={key:1},Ce={class:"pagination-container"},$e={key:0,class:"device-count"},ke={key:0,class:"register-result"},xe={class:"dialog-footer"},De=oe({__name:"DeviceScanDialog",props:{visible:{type:Boolean,default:!1},groupOptions:{type:Array,default:()=>[]}},emits:["update:visible","done"],setup(z,{emit:U}){const x=z,D=U,w=T({get:()=>x.visible,set:l=>D("update:visible",l)}),u=_([]),c=_([]),h=_(!1),o=_(!1),y=_(null),S=_(""),F=_(null),m=_(null),b=_(1),C=_(50),R=T(()=>u.value.filter(l=>!l.isRegistered)),G=T(()=>{const l=(b.value-1)*C.value,e=l+C.value;return u.value.slice(l,e)});function L(l){C.value=l,b.value=1}function q(l){b.value=l}function V(){return I(this,null,function*(){try{h.value=!0,m.value=null;const l=yield ne();if(l.code===0){if(u.value=l.data.devices,u.value.length===0)s.warning("未检测到任何连接的设备，请确保设备已正确连接");else{const e=u.value.filter(v=>!v.isRegistered).length;e===0?s.info("所有设备已注册，无需添加新设备"):s.success(`扫描成功，发现 ${u.value.length} 个设备，其中 ${e} 个未注册`)}b.value=1}else s.error(`扫描失败: ${l.message}`)}catch(l){s.error(`扫描出错: ${l.message||"未知错误"}`)}finally{h.value=!1}})}function H(l){c.value=l}function K(l){c.value=l}function Q(){return I(this,null,function*(){if(R.value.length===0){s.warning("没有可添加的未注册设备");return}try{if((yield de.confirm(`确定要一键添加所有 ${R.value.length} 个未注册设备吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))==="confirm"){o.value=!0;const e=yield P({devices:R.value,groupId:y.value||0,namePrefix:S.value||""});if(e.code===0){const v={};for(const[f,B]of Object.entries(e.data.results))B&&(v[f]=B);m.value={successCount:e.data.successCount,failedCount:e.data.failedCount,failedDetails:v},e.data.failedCount===0?s.success(`成功添加 ${e.data.successCount} 个设备`):s.warning(`部分设备添加失败，成功: ${e.data.successCount}，失败: ${e.data.failedCount}`),c.value=[],V(),D("done")}else s.error(`添加设备失败: ${e.message}`)}}catch(l){l!=="cancel"&&s.error(`添加设备出错: ${l.message||"未知错误"}`)}finally{o.value=!1}})}function J(){return I(this,null,function*(){if(c.value.length===0){s.warning("请先选择需要添加的设备");return}try{o.value=!0;const l=yield P({devices:c.value,groupId:y.value||0,namePrefix:S.value||""});if(l.code===0){const e={};for(const[v,f]of Object.entries(l.data.results))f&&(e[v]=f);m.value={successCount:l.data.successCount,failedCount:l.data.failedCount,failedDetails:e},l.data.failedCount===0?s.success(`成功添加 ${l.data.successCount} 个设备`):s.warning(`部分设备添加失败，成功: ${l.data.successCount}，失败: ${l.data.failedCount}`),c.value=[],V(),D("done")}else s.error(`添加设备失败: ${l.message}`)}catch(l){s.error(`添加设备出错: ${l.message||"未知错误"}`)}finally{o.value=!1}})}function W(l){return I(this,null,function*(){try{o.value=!0;const e=yield P({devices:[l],groupId:y.value||0,namePrefix:S.value||""});if(e.code===0){if(e.data.successCount>0)s.success(`设备 ${l.deviceId} 添加成功`);else{const v=e.data.results[l.deviceId]||"未知错误";s.error(`设备 ${l.deviceId} 添加失败: ${v}`)}V(),D("done")}else s.error(`添加设备失败: ${e.message}`)}catch(e){s.error(`添加设备出错: ${e.message||"未知错误"}`)}finally{o.value=!1}})}function X(){u.value=[],c.value=[],m.value=null,b.value=1,C.value=50}return ie(()=>{w.value&&V()}),(l,e)=>{const v=g("el-alert"),f=g("el-button"),B=g("el-option"),Y=g("el-select"),Z=g("el-input"),p=g("el-table-column"),N=g("el-tag"),ee=g("el-table"),le=g("el-pagination"),te=g("el-empty"),ae=g("el-dialog"),se=re("loading");return r(),M(ae,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=t=>w.value=t),title:"添加设备",width:"80%",fullscreen:!1,"destroy-on-close":"",onClosed:X,class:"device-scan-dialog","modal-append-to-body":!1,"append-to-body":!0},{footer:n(()=>[i("div",xe,[a(f,{onClick:e[5]||(e[5]=t=>w.value=!1)},{default:n(()=>e[12]||(e[12]=[k("关闭")])),_:1}),a(f,{disabled:c.value.length===0,loading:o.value,onClick:J},{default:n(()=>[k(" 添加设备("+d(c.value.length)+") ",1)]),_:1},8,["disabled","loading"])])]),default:n(()=>[i("div",ve,[i("div",fe,[i("div",pe,[a(v,{type:"info",closable:!1,"show-icon":"",style:{"max-width":"95%","margin-right":"15px"}},{default:n(()=>e[7]||(e[7]=[i("p",null," 系统将自动扫描通过 ADB 连接的所有设备，支持 USB 连接和网络连接的设备 ",-1),i("p",null," 已注册的设备会被标记，您可以选择未注册设备进行批量添加 ",-1)])),_:1})]),i("div",ge,[a(f,{loading:h.value,onClick:V},{default:n(()=>[k(d(h.value?"扫描中...":"开始扫描"),1)]),_:1},8,["loading"]),a(f,{onClick:e[0]||(e[0]=t=>w.value=!1)},{default:n(()=>e[8]||(e[8]=[k("取消")])),_:1})])]),ue((r(),$("div",me,[u.value.length>0?(r(),$(E,{key:0},[i("div",_e,[i("div",he,[e[9]||(e[9]=i("span",null,"添加到分组：",-1)),a(Y,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"请选择分组",clearable:"",style:{width:"180px"}},{default:n(()=>[(r(!0),$(E,null,O(z.groupOptions,t=>(r(),M(B,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i("div",ye,[e[10]||(e[10]=i("span",null,"设备名称前缀：",-1)),a(Z,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=t=>S.value=t),placeholder:"设备名称前缀",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),i("div",null,[a(f,{size:"small",disabled:R.value.length===0,loading:o.value,onClick:Q},{default:n(()=>[k(" 一键添加("+d(R.value.length)+") ",1)]),_:1},8,["disabled","loading"])])]),i("div",be,[a(ee,{ref_key:"deviceTable",ref:F,data:G.value,border:"",style:{width:"100%"},onSelect:H,onSelectAll:K},{default:n(()=>[a(p,{type:"selection",width:"55",selectable:t=>!t.isRegistered,fixed:""},null,8,["selectable"]),a(p,{prop:"deviceId",label:"设备ID","min-width":"180","show-overflow-tooltip":""}),a(p,{prop:"model",label:"设备型号","min-width":"120"}),a(p,{prop:"brand",label:"设备品牌","min-width":"100"}),a(p,{prop:"androidVersion",label:"安卓版本","min-width":"100"}),a(p,{prop:"androidId",label:"设备标识","min-width":"180","show-overflow-tooltip":""}),a(p,{prop:"resolution",label:"分辨率","min-width":"120"}),a(p,{prop:"density",label:"屏幕密度","min-width":"100"}),a(p,{prop:"status",label:"状态","min-width":"100"},{default:n(t=>[a(N,{type:t.row.status==="online"?"success":"danger"},{default:n(()=>[k(d(t.row.status==="online"?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),a(p,{label:"注册状态","min-width":"100"},{default:n(t=>[a(N,{type:t.row.isRegistered?"info":"warning"},{default:n(()=>[k(d(t.row.isRegistered?"已注册":"未注册"),1)]),_:2},1032,["type"])]),_:1}),a(p,{label:"操作","min-width":"100",fixed:"right"},{default:n(t=>[t.row.isRegistered?(r(),$("span",we,"-")):(r(),M(f,{key:0,link:"",type:"primary",size:"small",onClick:A=>W(t.row)},{default:n(()=>e[11]||(e[11]=[k(" 添加 ")])),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),i("div",Ce,[u.value.length>50?(r(),$("span",$e," 当前显示 "+d((b.value-1)*C.value+1)+"-"+d(Math.min(b.value*C.value,u.value.length))+" 条，共 "+d(u.value.length)+" 条 ",1)):j("",!0),a(le,{"current-page":b.value,"onUpdate:currentPage":e[3]||(e[3]=t=>b.value=t),"page-size":C.value,"onUpdate:pageSize":e[4]||(e[4]=t=>C.value=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:u.value.length,onSizeChange:L,onCurrentChange:q},null,8,["current-page","page-size","total"])])],64)):(r(),M(te,{key:1,description:"暂无设备，请点击扫描按钮开始检测"}))])),[[se,h.value]]),m.value?(r(),$("div",ke,[a(v,{type:m.value.failedCount>0?"warning":"success",closable:!1,"show-icon":""},{default:n(()=>[i("p",null,"注册完成，成功: "+d(m.value.successCount)+"，失败: "+d(m.value.failedCount),1),m.value.failedCount>0?(r(!0),$(E,{key:0},O(m.value.failedDetails,(t,A)=>(r(),$("p",{key:A}," 设备 "+d(A)+" 失败: "+d(t),1))),128)):j("",!0)]),_:1},8,["type"])])):j("",!0)])]),_:1},8,["modelValue"])}}}),Ie=ce(De,[["__scopeId","data-v-ec36bbee"]]);export{Ie as default};
