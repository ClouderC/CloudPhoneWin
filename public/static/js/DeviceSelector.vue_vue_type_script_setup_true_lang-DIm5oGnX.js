var w=(b,k,a)=>new Promise((m,i)=>{var c=n=>{try{l(a.next(n))}catch(f){i(f)}},p=n=>{try{l(a.throw(n))}catch(f){i(f)}},l=n=>n.done?m(n.value):Promise.resolve(n.value).then(c,p);l((a=a.apply(b,k)).next())});import{g as M}from"./device-MWnAPMey.js";import{v as F,r as y,e as R,A as C,o as q,a8 as g,U as u,q as r,R as s,H as v,D as d,E as A,p as h,K as B,L as D,G as _,Q as I,S as L}from"./index-DqYxAufE.js";const G={style:{float:"right",color:"#8492a6","font-size":"13px"}},H={style:{float:"right",color:"#8492a6","font-size":"13px"}},K={class:"dialog-footer"},J=F({__name:"DeviceSelector",props:{title:{default:"选择设备"},visible:{type:Boolean},multiSelect:{type:Boolean,default:!0},maxWorker:{default:50}},emits:["update:visible","confirm","cancel"],setup(b,{emit:k}){const a=b,m=k,i=y(a.visible),c=y([]),p=y(!1),l=R({deviceId:"",deviceIds:[],maxWorker:a.maxWorker});C(()=>a.visible,e=>{i.value=e,e&&(n(),l.deviceId="",l.deviceIds=[],l.maxWorker=a.maxWorker)}),C(i,e=>{m("update:visible",e)}),q(()=>{i.value=a.visible,a.visible&&n()});const n=()=>w(null,null,function*(){p.value=!0;try{const e=yield M({page:1,pageSize:100});e.code===0?c.value=e.data.list:g.error(e.message||"获取设备列表失败")}catch(e){console.error("获取设备列表出错:",e);let o="获取设备列表出错";e.response&&e.response.data&&e.response.data.message?o=e.response.data.message:e.message&&(o=e.message),g.error(o)}finally{p.value=!1}}),f=()=>{if(a.multiSelect&&l.deviceIds.length===0){g.warning("请选择至少一个设备");return}if(!a.multiSelect&&!l.deviceId){g.warning("请选择设备");return}const e=a.multiSelect?{deviceIds:l.deviceIds,maxWorker:l.maxWorker}:{deviceId:l.deviceId};m("confirm",e)},U=()=>{i.value=!1,m("update:visible",!1),m("cancel")};return(e,o)=>{const V=d("el-option"),x=d("el-select"),S=d("el-form-item"),N=d("el-input-number"),z=d("el-form"),W=d("el-button"),E=d("el-dialog");return r(),u(E,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=t=>i.value=t),title:e.title,width:"500px"},{footer:s(()=>[_("span",K,[v(W,{onClick:U},{default:s(()=>o[4]||(o[4]=[L("取消")])),_:1}),v(W,{type:"primary",onClick:f,loading:p.value},{default:s(()=>o[5]||(o[5]=[L(" 确认 ")])),_:1},8,["loading"])])]),default:s(()=>[v(z,{ref:"deviceFormRef",model:l,"label-width":"100px"},{default:s(()=>[v(S,{label:(e.multiSelect,"选择设备"),prop:e.multiSelect?"deviceIds":"deviceId"},{default:s(()=>[e.multiSelect?(r(),u(x,{key:0,modelValue:l.deviceIds,"onUpdate:modelValue":o[0]||(o[0]=t=>l.deviceIds=t),multiple:"",placeholder:"请选择设备",style:{width:"100%"}},{default:s(()=>[(r(!0),h(B,null,D(c.value,t=>(r(),u(V,{key:t.deviceId,label:t.name,value:t.deviceId},{default:s(()=>[_("span",null,I(t.name),1),_("span",G,I(t.deviceId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):(r(),u(x,{key:1,modelValue:l.deviceId,"onUpdate:modelValue":o[1]||(o[1]=t=>l.deviceId=t),placeholder:"请选择设备",style:{width:"100%"}},{default:s(()=>[(r(!0),h(B,null,D(c.value,t=>(r(),u(V,{key:t.deviceId,label:t.name,value:t.deviceId},{default:s(()=>[_("span",null,I(t.name),1),_("span",H,I(t.deviceId),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label","prop"]),e.multiSelect?(r(),u(S,{key:0,label:"最大并发",prop:"maxWorker"},{default:s(()=>[v(N,{modelValue:l.maxWorker,"onUpdate:modelValue":o[2]||(o[2]=t=>l.maxWorker=t),min:1,max:100},null,8,["modelValue"])]),_:1})):A("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});export{J as _};
