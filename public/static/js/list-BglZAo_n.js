var S=(c,t,u)=>new Promise((x,g)=>{var B=f=>{try{k(u.next(f))}catch(y){g(y)}},C=f=>{try{k(u.throw(f))}catch(y){g(y)}},k=f=>f.done?x(f.value):Promise.resolve(f.value).then(B,C);k((u=u.apply(c,t)).next())});import{a8 as d,v as ue,r as s,o as de,p as q,q as F,H as l,R as a,G as r,D as v,S as p,F as ie,ae as pe,U as G,Q as K,k as z,E as I,aE as me,K as ve,aD as ce,_ as fe}from"./index-DqYxAufE.js";import{u as ge,g as _e,c as ke,d as be}from"./app-CvfiZxnR.js";function we(c){return S(this,null,function*(){try{const t=yield ge(c);if(t.code===0)return d.success("应用导入成功"),t.data;throw d.error(t.message||"上传失败"),new Error(t.message||"上传失败")}catch(t){if(console.error("上传出错:",t),t.code===400&&t.message&&t.message.includes("已存在"))throw d.warning(t.message),t;if(t.response&&t.response.data){const u=t.response.data;if(u.code===400&&u.message&&u.message.includes("已存在"))throw d.warning(u.message),new Error(u.message)}throw d.error(t.message||"上传出错"),t}})}function L(c){return c<1024?c+"B":c<1048576?(c/1024).toFixed(2)+"KB":c<1073741824?(c/1048576).toFixed(2)+"MB":(c/1073741824).toFixed(2)+"GB"}const Ve={class:"page-container"},Be={class:"card-header"},Ce={class:"search-bar"},xe={class:"card-content"},ye={class:"pagination-container"},he={class:"dialog-footer"},Ae={class:"file-info"},Pe={class:"dialog-footer"},Fe=ue({__name:"list",setup(c){const t=s([]),u=s(!1),x=s(0),g=s(1),B=s(50),C=s(""),k=s(!1),f=s(!1),y=s("create"),h=s(!1),U=s(),i=s({name:"",packageName:"",version:"",size:0,apkPath:""}),_=s([]),$={name:[{required:!0,message:"请输入应用名称",trigger:"blur"}],packageName:[{required:!0,message:"请输入包名",trigger:"blur"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"}],apkPath:[{required:!0,message:"请上传APK文件",trigger:"blur"}]},H=s(),Q=s({file:null}),b=s(0),N=s(!1);de(()=>{w()});const w=()=>{u.value=!0,_e({page:g.value,pageSize:B.value,keyword:C.value||void 0}).then(n=>{n.code===0?(t.value=n.data.list,x.value=n.data.total):d.error(n.message||"获取应用列表失败")}).catch(n=>{console.error("获取应用列表出错:",n),d.error("获取应用列表出错")}).finally(()=>{u.value=!1})},M=()=>{g.value=1,w()},j=()=>{C.value="",M()},J=n=>{g.value=n,w()},O=n=>{B.value=n,g.value=1,w()},E=(n=!1)=>{f.value=!0,_.value=[],b.value=0},W=n=>{_.value=[n]},D=()=>{f.value=!1,_.value=[],b.value=0,h.value=!1},X=()=>S(null,null,function*(){if(_.value.length===0){d.warning("请选择要上传的APK文件");return}const n=_.value[0].raw;if(!n){d.warning("文件数据无效");return}h.value=!0,b.value=0;const e=setInterval(()=>{b.value<90&&(b.value+=10)},300);try{yield we(n),b.value=100,w(),setTimeout(()=>{D()},1e3)}catch(m){console.error("上传出错:",m),m.message&&m.message.includes("已存在")&&(w(),setTimeout(()=>{D()},1e3))}finally{clearInterval(e),h.value=!1}}),Y=()=>{U.value&&U.value.validate(n=>{n&&(N.value=!0,ke({name:i.value.name,packageName:i.value.packageName,version:i.value.version,size:i.value.size,apkPath:i.value.apkPath}).then(e=>{e.code===0?(d.success("应用创建成功"),k.value=!1,w()):d.error(e.message||"创建失败")}).catch(e=>{console.error("创建应用出错:",e),d.error("创建应用出错")}).finally(()=>{N.value=!1}))})},Z=n=>{ce.confirm(`确定要删除应用 "${n.name}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{be(n.id).then(e=>{e.code===0?(d.success("删除成功"),w()):d.error(e.message||"删除失败")}).catch(e=>{console.error("删除应用出错:",e),d.error("删除应用出错")})}).catch(()=>{})};return(n,e)=>{const m=v("el-button"),A=v("el-input"),V=v("el-table-column"),ee=v("el-button-group"),le=v("el-table"),ae=v("el-pagination"),oe=v("el-card"),P=v("el-form-item"),R=v("el-form"),T=v("el-dialog"),te=v("el-icon"),ne=v("el-upload"),se=v("el-progress"),re=pe("loading");return F(),q("div",Ve,[l(oe,{class:"box-card"},{header:a(()=>[r("div",Be,[e[13]||(e[13]=r("span",null,"应用列表",-1)),r("div",null,[l(m,{onClick:e[0]||(e[0]=o=>E())},{default:a(()=>e[12]||(e[12]=[p("导入应用")])),_:1})])])]),default:a(()=>[r("div",Ce,[l(A,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=o=>C.value=o),placeholder:"搜索应用名称",class:"search-input"},null,8,["modelValue"]),l(m,{onClick:M},{default:a(()=>e[14]||(e[14]=[p("搜索")])),_:1}),l(m,{onClick:j},{default:a(()=>e[15]||(e[15]=[p("重置")])),_:1})]),r("div",xe,[ie((F(),G(le,{data:t.value,style:{width:"100%"}},{default:a(()=>[l(V,{prop:"id",label:"应用ID",width:"80"}),l(V,{prop:"name",label:"应用名称",width:"180"}),l(V,{prop:"packageName",label:"包名",width:"220"}),l(V,{prop:"version",label:"版本",width:"120"}),l(V,{label:"大小",width:"120"},{default:a(({row:o})=>[p(K(z(L)(o.size)),1)]),_:1}),l(V,{prop:"updatedAt",label:"更新时间",width:"180"},{default:a(({row:o})=>[p(K(o.updatedAt||"未知"),1)]),_:1}),l(V,{label:"操作",width:"120"},{default:a(({row:o})=>[l(ee,null,{default:a(()=>[l(m,{type:"danger",link:"",onClick:Ke=>Z(o)},{default:a(()=>e[16]||(e[16]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[re,u.value]]),r("div",ye,[l(ae,{"current-page":g.value,"onUpdate:currentPage":e[2]||(e[2]=o=>g.value=o),"page-size":B.value,"onUpdate:pageSize":e[3]||(e[3]=o=>B.value=o),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next",onSizeChange:O,onCurrentChange:J},null,8,["current-page","page-size","total"])])])]),_:1}),l(T,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=o=>k.value=o),title:y.value==="create"?"添加应用":"编辑应用",width:"500px"},{footer:a(()=>[r("span",he,[l(m,{onClick:e[9]||(e[9]=o=>k.value=!1)},{default:a(()=>e[18]||(e[18]=[p("取消")])),_:1}),l(m,{loading:N.value,onClick:Y},{default:a(()=>e[19]||(e[19]=[p(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>[l(R,{ref_key:"appFormRef",ref:U,model:i.value,"label-width":"100px",rules:$},{default:a(()=>[l(P,{label:"应用名称",prop:"name"},{default:a(()=>[l(A,{modelValue:i.value.name,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.name=o),placeholder:"请输入应用名称"},null,8,["modelValue"])]),_:1}),l(P,{label:"包名",prop:"packageName"},{default:a(()=>[l(A,{modelValue:i.value.packageName,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value.packageName=o),placeholder:"请输入包名"},null,8,["modelValue"])]),_:1}),l(P,{label:"版本",prop:"version"},{default:a(()=>[l(A,{modelValue:i.value.version,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value.version=o),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1}),l(P,{label:"APK路径",prop:"apkPath"},{default:a(()=>[l(A,{modelValue:i.value.apkPath,"onUpdate:modelValue":e[8]||(e[8]=o=>i.value.apkPath=o),placeholder:"请上传APK文件获取路径",disabled:""},{append:a(()=>[l(m,{onClick:e[7]||(e[7]=o=>E(!0))},{default:a(()=>e[17]||(e[17]=[p("上传")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(T,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=o=>f.value=o),title:"上传APK文件",width:"500px"},{footer:a(()=>[r("span",Pe,[l(m,{onClick:D},{default:a(()=>e[24]||(e[24]=[p("取消")])),_:1}),l(m,{loading:h.value,onClick:X},{default:a(()=>e[25]||(e[25]=[p(" 上传 ")])),_:1},8,["loading"])])]),default:a(()=>[l(R,{ref_key:"uploadFormRef",ref:H,model:Q.value,"label-width":"100px"},{default:a(()=>[l(P,{label:"APK文件"},{default:a(()=>[l(ne,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":W,"file-list":_.value,accept:".apk"},{tip:a(()=>e[20]||(e[20]=[r("div",{class:"el-upload__tip"},"只能上传APK文件",-1)])),default:a(()=>[l(te,{class:"el-icon--upload"},{default:a(()=>[l(z(me))]),_:1}),e[21]||(e[21]=r("div",{class:"el-upload__text"},[p(" 拖拽文件到此处或 "),r("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),_.value.length>0?(F(),q(ve,{key:0},[r("div",Ae,[r("p",null,[e[22]||(e[22]=r("strong",null,"文件名：",-1)),p(K(_.value[0].name),1)]),r("p",null,[e[23]||(e[23]=r("strong",null,"大小：",-1)),p(K(z(L)(_.value[0].size||0)),1)])]),h.value?(F(),G(se,{key:0,percentage:b.value,status:b.value===100?"success":"exception"},null,8,["percentage","status"])):I("",!0)],64)):I("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Se=fe(Fe,[["__scopeId","data-v-070f7984"]]);export{Se as default};
