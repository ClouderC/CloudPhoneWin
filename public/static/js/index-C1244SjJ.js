var Pe=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var te=(_,p,s)=>p in _?Pe(_,p,{enumerable:!0,configurable:!0,writable:!0,value:s}):_[p]=s,oe=(_,p)=>{for(var s in p||(p={}))Ee.call(p,s)&&te(_,s,p[s]);if(ae)for(var s of ae(p))Ke.call(p,s)&&te(_,s,p[s]);return _};var V=(_,p,s)=>new Promise((C,I)=>{var k=f=>{try{U(s.next(f))}catch(h){I(h)}},K=f=>{try{U(s.throw(f))}catch(h){I(h)}},U=f=>f.done?C(f.value):Promise.resolve(f.value).then(k,K);U((s=s.apply(_,p)).next())});import{v as Le,r as u,o as Me,p as A,q as D,H as l,R as a,F as Oe,G as z,ae as Te,U as H,D as r,S as i,Q as Ae,aC as de,k as G,aF as Y,K as Z,L as ee,aG as He,aH as Qe,aI as je,a8 as n,aD as ue,_ as Je}from"./index-DqYxAufE.js";import{g as We,d as Xe,u as Ye,s as Ze,b as el,a as ll,c as al}from"./device-MWnAPMey.js";import{b as tl}from"./group-C52rk5Pr.js";import ol from"./DeviceScanDialog-Cm-1r2pD.js";const dl={class:"device-manage"},ul={class:"card-header"},nl={class:"pagination-container"},sl={class:"dialog-footer"},rl={class:"dialog-footer"},il={class:"dialog-footer"},pl={class:"dialog-footer"},vl=Le({__name:"index",setup(_){const p=u(!1),s=u(""),C=u(""),I=u(1),k=u(100),K=u(0),U=u([]),f=u(null),h=u([]),q=u(!1),le=u("新增设备"),Q=u(),o=u({id:void 0,name:"",deviceId:"",groupId:0,status:"online",model:"",brand:"",androidVersion:"",androidId:"",resolution:"",density:""}),ne={name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],deviceId:[{required:!0,message:"请输入设备ID",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},b=u([]),N=u(!1),j=u(),S=u({groupId:void 0}),se={groupId:[{required:!0,message:"请选择目标分组",trigger:"change"}]},P=u(!1),J=u(),R=u({status:"online"}),re={status:[{required:!0,message:"请选择状态",trigger:"change"}]},W=u(!1),B=u(!1),X=u(),F=u({preset:"720x1280"}),ie={preset:[{required:!0,message:"请选择分辨率预设",trigger:"change"}]},c=()=>V(null,null,function*(){p.value=!0;try{const d={page:I.value,pageSize:k.value};s.value&&(d.deviceName=s.value),C.value&&(d.deviceId=C.value),f.value!==void 0&&(d.groupId=f.value);const e=yield We(d);e.code===0?(U.value=e.data.list,K.value=e.data.total,e.data.groupOptions&&(h.value=e.data.groupOptions)):n.error(e.message||"获取设备列表失败")}catch(d){console.error("获取设备列表失败:",d);let e="获取设备列表失败";d.response&&d.response.data&&d.response.data.message?e=d.response.data.message:d.message&&(e=d.message),n.error(e)}finally{p.value=!1}}),pe=()=>{c()},L=()=>{I.value=1,c()},ve=()=>{s.value="",C.value="",f.value=null,I.value=1,c()},me=d=>{k.value=d,c()},fe=d=>{I.value=d,c()},ce=d=>{le.value="编辑设备",o.value=oe({},d),q.value=!0},ge=d=>{ue.confirm("确认删除该设备吗？","提示",{type:"warning"}).then(()=>V(null,null,function*(){try{(yield Xe(d.id)).code===0&&(n.success("删除成功"),c())}catch(e){console.error("删除设备失败:",e),n.error("删除设备失败")}})).catch(()=>{})},be=()=>V(null,null,function*(){Q.value&&(yield Q.value.validate(d=>V(null,null,function*(){if(d)try{let e;o.value.id?e=yield Ye({id:o.value.id,name:o.value.name,deviceId:o.value.deviceId,status:o.value.status,groupId:o.value.groupId,model:o.value.model,brand:o.value.brand,androidVersion:o.value.androidVersion,androidId:o.value.androidId,resolution:o.value.resolution,density:o.value.density}):e=yield Ze({name:o.value.name,deviceId:o.value.deviceId,status:o.value.status,groupId:o.value.groupId,model:o.value.model,brand:o.value.brand,androidVersion:o.value.androidVersion,androidId:o.value.androidId,resolution:o.value.resolution,density:o.value.density}),e.code===0?(n.success(o.value.id?"更新成功":"创建成功"),q.value=!1,c()):n.error(e.message||"保存失败")}catch(e){console.error("保存设备失败:",e),n.error("保存设备失败")}})))}),Ve=d=>{b.value=d},_e=()=>{if(b.value.length===0){n.warning("请先选择要修改的设备");return}S.value.groupId=void 0,N.value=!0},ye=()=>V(null,null,function*(){j.value&&(yield j.value.validate(d=>V(null,null,function*(){if(d&&S.value.groupId!==void 0)try{yield tl({groupId:S.value.groupId,deviceIds:b.value.map(e=>e.id)}),n.success("批量修改成功"),N.value=!1,c()}catch(e){console.error("批量修改失败:",e),n.error("批量修改失败")}})))}),we=()=>{R.value.status="online",P.value=!0},Ie=()=>V(null,null,function*(){J.value&&(yield J.value.validate(d=>V(null,null,function*(){if(d&&R.value.status!==void 0)try{yield el({status:R.value.status,deviceIds:b.value.map(e=>e.id)}),n.success("批量修改状态成功"),P.value=!1,c()}catch(e){console.error("批量修改状态失败:",e),n.error("批量修改状态失败")}})))}),he=()=>{if(b.value.length===0){n.warning("请先选择要修改的设备");return}F.value.preset="720x1280",B.value=!0},xe=()=>V(null,null,function*(){X.value&&(yield X.value.validate(d=>V(null,null,function*(){if(d&&F.value.preset)try{const e=yield ll({deviceIds:b.value.map(y=>String(y.id)),preset:F.value.preset});B.value=!1,c(),e.code===0?e.data.failedCount>0?n.warning(`部分设备设置失败，成功: ${e.data.successCount}, 失败: ${e.data.failedCount}`):n.success("批量修改分辨率成功"):n.error(e.message||"批量修改分辨率失败")}catch(e){B.value=!1,c(),console.error("批量修改分辨率失败:",e),n.error("批量修改分辨率失败")}})))}),De=()=>{if(b.value.length===0){n.warning("请先选择要删除的设备");return}ue.confirm(`确认删除选中的 ${b.value.length} 个设备吗？此操作不可恢复！`,"批量删除设备",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}).then(()=>V(null,null,function*(){try{const d=b.value.map(y=>y.id),e=yield al(d);e.code===0?(n.success(`成功删除 ${e.data.successCount} 个设备`),c()):n.error(`删除失败：${e.message}`)}catch(d){console.error("批量删除设备失败:",d),n.error("批量删除设备失败")}})).catch(()=>{})},Ce=()=>{W.value=!0},ke=d=>{if(b.value.length===0){n.warning("请先选择要操作的设备");return}switch(d){case"updateGroup":_e();break;case"updateStatus":we();break;case"updateResolution":he();break;case"delete":De();break}};return Me(()=>{c()}),(d,e)=>{const y=r("el-icon"),w=r("el-input"),E=r("el-col"),x=r("el-option"),$=r("el-select"),m=r("el-button"),M=r("el-dropdown-item"),Ue=r("el-dropdown-menu"),Se=r("el-dropdown"),Re=r("el-row"),v=r("el-table-column"),Be=r("el-tag"),Fe=r("el-button-group"),$e=r("el-table"),ze=r("el-pagination"),Ge=r("el-card"),g=r("el-form-item"),O=r("el-form"),T=r("el-dialog"),qe=Te("loading");return D(),A("div",dl,[l(Ge,{class:"box-card"},{header:a(()=>[z("div",ul,[l(Re,{gutter:20,class:"mb-4"},{default:a(()=>[l(E,{span:3},{default:a(()=>[l(w,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value=t),placeholder:"设备名称模糊查询",clearable:"",onKeyup:de(L,["enter"])},{prefix:a(()=>[l(y,null,{default:a(()=>[l(G(Y))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(E,{span:3},{default:a(()=>[l(w,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),placeholder:"设备ID模糊查询",clearable:"",onKeyup:de(L,["enter"])},{prefix:a(()=>[l(y,null,{default:a(()=>[l(G(Y))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(E,{span:3},{default:a(()=>[l($,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"选择分组",clearable:"",style:{width:"100%"},onChange:L},{default:a(()=>[(D(!0),A(Z,null,ee(h.value,t=>(D(),H(x,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(E,{span:4},{default:a(()=>[l(m,{onClick:L,class:"mr-2"},{default:a(()=>[l(y,null,{default:a(()=>[l(G(Y))]),_:1}),e[27]||(e[27]=i("搜索 "))]),_:1}),l(m,{onClick:ve},{default:a(()=>[l(y,null,{default:a(()=>[l(G(He))]),_:1}),e[28]||(e[28]=i("清空 "))]),_:1})]),_:1}),l(E,{span:11,class:"text-right"},{default:a(()=>[l(Se,{disabled:b.value.length===0,onCommand:ke,trigger:"click",class:"mr-2"},{dropdown:a(()=>[l(Ue,null,{default:a(()=>[l(M,{command:"updateGroup"},{default:a(()=>e[30]||(e[30]=[i("修改分组")])),_:1}),l(M,{command:"updateStatus"},{default:a(()=>e[31]||(e[31]=[i("修改状态")])),_:1}),l(M,{command:"updateResolution"},{default:a(()=>e[32]||(e[32]=[i("修改分辨率")])),_:1}),l(M,{command:"delete",divided:""},{default:a(()=>e[33]||(e[33]=[i("批量删除")])),_:1})]),_:1})]),default:a(()=>[l(m,{disabled:b.value.length===0},{default:a(()=>[e[29]||(e[29]=i(" 批量操作")),l(y,{class:"el-icon--right"},{default:a(()=>[l(G(Qe))]),_:1})]),_:1},8,["disabled"])]),_:1},8,["disabled"]),l(m,{onClick:Ce,class:"ml-2"},{default:a(()=>[l(y,null,{default:a(()=>[l(G(je))]),_:1}),e[34]||(e[34]=i("添加设备 "))]),_:1})]),_:1})]),_:1})])]),default:a(()=>[Oe((D(),H($e,{data:U.value,border:"",style:{width:"100%"},onSelectionChange:Ve},{default:a(()=>[l(v,{type:"selection",width:"55"}),l(v,{prop:"id",label:"ID",width:"80"}),l(v,{prop:"name",label:"设备名称"}),l(v,{prop:"deviceId",label:"设备ID"}),l(v,{prop:"model",label:"设备型号",width:"120"}),l(v,{prop:"brand",label:"设备品牌",width:"100"}),l(v,{prop:"androidVersion",label:"安卓版本",width:"100"}),l(v,{prop:"androidId",label:"设备标识",width:"180","show-overflow-tooltip":""}),l(v,{prop:"resolution",label:"分辨率",width:"120"}),l(v,{prop:"density",label:"屏幕密度",width:"100"}),l(v,{prop:"portForward",label:"端口转发",width:"100"}),l(v,{prop:"groupName",label:"所属分组"}),l(v,{prop:"status",label:"状态"},{default:a(({row:t})=>[l(Be,{type:t.status==="online"?"success":"danger"},{default:a(()=>[i(Ae(t.status==="online"?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),l(v,{prop:"createdAt",label:"创建时间"}),l(v,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(Fe,null,{default:a(()=>[l(m,{type:"primary",link:"",onClick:Ne=>ce(t)},{default:a(()=>e[35]||(e[35]=[i(" 编辑 ")])),_:2},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:Ne=>ge(t)},{default:a(()=>e[36]||(e[36]=[i(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[qe,p.value]]),z("div",nl,[l(ze,{"current-page":I.value,"onUpdate:currentPage":e[3]||(e[3]=t=>I.value=t),"page-size":k.value,"onUpdate:pageSize":e[4]||(e[4]=t=>k.value=t),"page-sizes":[10,20,50,100],total:K.value,layout:"total, sizes, prev, pager, next",onSizeChange:me,onCurrentChange:fe},null,8,["current-page","page-size","total"])])]),_:1}),l(T,{title:le.value,modelValue:q.value,"onUpdate:modelValue":e[16]||(e[16]=t=>q.value=t),width:"500px","destroy-on-close":""},{footer:a(()=>[z("span",sl,[l(m,{onClick:e[15]||(e[15]=t=>q.value=!1)},{default:a(()=>e[37]||(e[37]=[i("取消")])),_:1}),l(m,{type:"primary",onClick:be},{default:a(()=>e[38]||(e[38]=[i(" 确定 ")])),_:1})])]),default:a(()=>[l(O,{ref_key:"formRef",ref:Q,model:o.value,rules:ne,"label-width":"100px",style:{"max-width":"460px"}},{default:a(()=>[l(g,{label:"设备名称",prop:"name"},{default:a(()=>[l(w,{modelValue:o.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.name=t)},null,8,["modelValue"])]),_:1}),l(g,{label:"设备ID",prop:"deviceId"},{default:a(()=>[l(w,{modelValue:o.value.deviceId,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.deviceId=t)},null,8,["modelValue"])]),_:1}),l(g,{label:"设备型号",prop:"model"},{default:a(()=>[l(w,{modelValue:o.value.model,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.model=t),placeholder:"如：Pixel 6"},null,8,["modelValue"])]),_:1}),l(g,{label:"设备品牌",prop:"brand"},{default:a(()=>[l(w,{modelValue:o.value.brand,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.brand=t),placeholder:"如：Google"},null,8,["modelValue"])]),_:1}),l(g,{label:"安卓版本",prop:"androidVersion"},{default:a(()=>[l(w,{modelValue:o.value.androidVersion,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.androidVersion=t),placeholder:"如：Android 13"},null,8,["modelValue"])]),_:1}),l(g,{label:"设备标识",prop:"androidId"},{default:a(()=>[l(w,{modelValue:o.value.androidId,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.androidId=t),placeholder:"设备唯一标识符"},null,8,["modelValue"])]),_:1}),l(g,{label:"分辨率",prop:"resolution"},{default:a(()=>[l(w,{modelValue:o.value.resolution,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.resolution=t),placeholder:"如：1920x1080"},null,8,["modelValue"])]),_:1}),l(g,{label:"屏幕密度",prop:"density"},{default:a(()=>[l(w,{modelValue:o.value.density,"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.density=t),placeholder:"如：420dpi"},null,8,["modelValue"])]),_:1}),l(g,{label:"所属分组",prop:"groupId"},{default:a(()=>[l($,{modelValue:o.value.groupId,"onUpdate:modelValue":e[13]||(e[13]=t=>o.value.groupId=t),placeholder:"请选择分组",style:{width:"100%"}},{default:a(()=>[(D(!0),A(Z,null,ee(h.value,t=>(D(),H(x,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"状态",prop:"status"},{default:a(()=>[l($,{modelValue:o.value.status,"onUpdate:modelValue":e[14]||(e[14]=t=>o.value.status=t),style:{width:"100%"}},{default:a(()=>[l(x,{label:"在线",value:"online"}),l(x,{label:"离线",value:"offline"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(T,{title:"批量修改分组",modelValue:N.value,"onUpdate:modelValue":e[19]||(e[19]=t=>N.value=t),width:"500px","destroy-on-close":""},{footer:a(()=>[z("span",rl,[l(m,{onClick:e[18]||(e[18]=t=>N.value=!1)},{default:a(()=>e[39]||(e[39]=[i("取消")])),_:1}),l(m,{type:"primary",onClick:ye},{default:a(()=>e[40]||(e[40]=[i(" 确定 ")])),_:1})])]),default:a(()=>[l(O,{ref_key:"batchFormRef",ref:j,model:S.value,rules:se,"label-width":"100px",style:{"max-width":"460px"}},{default:a(()=>[l(g,{label:"目标分组",prop:"groupId"},{default:a(()=>[l($,{modelValue:S.value.groupId,"onUpdate:modelValue":e[17]||(e[17]=t=>S.value.groupId=t),placeholder:"请选择分组",style:{width:"100%"}},{default:a(()=>[(D(!0),A(Z,null,ee(h.value,t=>(D(),H(x,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(T,{title:"批量修改状态",modelValue:P.value,"onUpdate:modelValue":e[22]||(e[22]=t=>P.value=t),width:"500px","destroy-on-close":""},{footer:a(()=>[z("span",il,[l(m,{onClick:e[21]||(e[21]=t=>P.value=!1)},{default:a(()=>e[41]||(e[41]=[i("取消")])),_:1}),l(m,{type:"primary",onClick:Ie},{default:a(()=>e[42]||(e[42]=[i(" 确定 ")])),_:1})])]),default:a(()=>[l(O,{ref_key:"batchStatusFormRef",ref:J,model:R.value,rules:re,"label-width":"100px",style:{"max-width":"460px"}},{default:a(()=>[l(g,{label:"设备状态",prop:"status"},{default:a(()=>[l($,{modelValue:R.value.status,"onUpdate:modelValue":e[20]||(e[20]=t=>R.value.status=t),placeholder:"请选择状态",style:{width:"100%"}},{default:a(()=>[l(x,{label:"在线",value:"online"}),l(x,{label:"离线",value:"offline"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(T,{title:"批量修改分辨率",modelValue:B.value,"onUpdate:modelValue":e[25]||(e[25]=t=>B.value=t),width:"500px","destroy-on-close":""},{footer:a(()=>[z("span",pl,[l(m,{onClick:e[24]||(e[24]=t=>B.value=!1)},{default:a(()=>e[43]||(e[43]=[i("取消")])),_:1}),l(m,{type:"primary",onClick:xe},{default:a(()=>e[44]||(e[44]=[i(" 确定 ")])),_:1})])]),default:a(()=>[l(O,{ref_key:"batchResolutionFormRef",ref:X,model:F.value,rules:ie,"label-width":"100px",style:{"max-width":"460px"}},{default:a(()=>[l(g,{label:"分辨率预设",prop:"preset"},{default:a(()=>[l($,{modelValue:F.value.preset,"onUpdate:modelValue":e[23]||(e[23]=t=>F.value.preset=t),placeholder:"请选择分辨率预设",style:{width:"100%"}},{default:a(()=>[l(x,{label:"720x1280 (DPI 320)",value:"720x1280"}),l(x,{label:"1080x1920 (DPI 480)",value:"1080x1920"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(ol,{visible:W.value,"onUpdate:visible":e[26]||(e[26]=t=>W.value=t),"group-options":h.value,onDone:pe},null,8,["visible","group-options"])])}}}),Vl=Je(vl,[["__scopeId","data-v-6c0ae8d3"]]);export{Vl as default};
